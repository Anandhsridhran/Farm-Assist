<!DOCTYPE html>
<html>
  <head>
    <meta id="extViewportMeta" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
   
    
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/jquery.mobile-1.3.1.css" />
    <link rel="stylesheet" href="css/custom.css" />
  </head>
<body id="main_db" style=" overflow-x:hidden;">
<div data-role="page" id="demo-page1" data-url="demo-page1" style="margin-top:15px;">

    <div data-role="header" id="heading" >
        <div style="text-align:center; padding-top: 2px;"> 
          <img src="images/mobile-logo-2.png" />
        </div>
        <a href="#left-panel"><i class='icon-reorder'></i></a>
        <a href="" onclick="db()" id="backfarms"><i class='icon-refresh'></i></a> 
        <div class="detail_db" style=" overflow-x:hidden;">
          Hog Owner -<span id="db_hog1" class="span_db"></span> 
        </div>
    </div><!-- /header -->
    	<div role="main" class="ui-content" style="margin-top: 25px;">
      
    	<ul data-role="listview" data-inset="true" id="admin_farms" class="list_view">
    	  <li data-role="list-divider">Farms List</li>
    	</ul>
   	</div><!-- /content -->
    <!-- <div data-role="footer" class="foot" data-position="fixed" style="background: url(images/Topbg.png);background-repeat: repeat;" >
      <div class="footermenu3" onclick="db()">
        <a href="#"><img src="images/footer-image-1.png" style="height:100%;" /></a>
      </div>
      <div class="footermenu3" onclick="user_logout();">
        <a href="#"><img src="images/signout.png" style="height:100%;" /></a>
      </div>       
      <div class="footermenu3">
        <a href="#left-panel"><img src="images/footer-image-5.png" style="height:100%" /></a>
      </div>  
  </div> -->
   	<div data-role="panel" data-transition="slide" data-position="left"  id="left-panel">
    	<ul data-role='listview'>
      		<li data-role="list-divider" id="heading_menu">Menu</li>
      		<li><a href="#" data-transition="slide" onclick="db()" data-ajax='false' rel="external"><i class='icon-dashboard'></i> Dashboard</a></li>
      		<li><a href="#" data-ajoutax='false' data-transition="slide"  onclick="user_logout();" rel="external"><i class='icon-signout'></i> Logout</a></li>
   		</ul>
    </div>
</div>
<div data-role="page" id="demo-page2"  data-url="demo-page2" style="margin-top:15px;">
    <div data-role="header" id="heading" >
        <!-- <a href="#left-panel"><i class='icon-reorder'></i></a> -->
        <div style="text-align:center; padding-top: 2px;">
            <img src="images/mobile-logo-2.png" />
        </div >
        <a href="#left-panel"><i class='icon-reorder'></i></a>
        <a href="" onclick="db()" id="backfarms"><i class='icon-chevron-left'></i></a>
        <div class="detail_db">
          <span id="smhead">Farm -</span><span id="db_farm1" class="span_db"></span></br>
          Hog Owner -<span id="db_hog2" class="span_db"></span> 
        </div>
    </div><!-- /header -->
    <div role="main" class="ui-content" id ="farm_locations" style="margin-top: 25px;">
     
        <ul data-role="listview" data-inset="true" id="locations_list" class="list_view">
        <li data-role="list-divider">Locations List</li>
      </ul>
   		
   	</div><!-- /content -->
  <!--   <div data-role="footer" class="foot" data-position="fixed" style="background: url(images/Topbg.png);background-repeat: repeat;" >
      <div class="footermenu3" onclick="db()">
        <a href="#"><img src="images/footer-image-1.png" style="height:100%;" /></a>
      </div>
      <div class="footermenu3" onclick="user_logout();">
        <a href="#"><img src="images/signout.png" style="height:100%;" /></a>
      </div>       
      <div class="footermenu3">
        <a href="#left-panel"><img src="images/footer-image-5.png" style="height:100%;" /></a>
      </div>  
    </div> -->
   	<div data-role="panel" data-transition="slide" data-position="left"  id="left-panel">
    	<ul data-role='listview'>
      		<li data-role="list-divider" id="heading_menu">Menu</li>
      		<li><a href="#" data-transition="slide" onclick="db()" data-ajax='false' rel="external"><i class='icon-dashboard'></i> Dashboard</a></li>
      		<li><a href="#" data-ajoutax='false' data-transition="slide"  onclick="user_logout();" rel="external"><i class='icon-signout'></i> Logout</a></li>
   		</ul>
    </div>
</div>  
<div data-role="page" id="demo-page3" data-url="demo-page3" style="margin-top:15px;">
    <div data-role="header" id="heading" >
        <div style="text-align:center; padding-top: 2px;">
            <img src="images/mobile-logo-2.png" />
        </div>
        <a href="#left-panel"><i class='icon-reorder'></i></a>
        <a href="" id="backloc1" onclick="loclis()"><i class='icon-chevron-left'></i></a>
        <div class="detail_db">
       Hog Owner -<span id="db_hog3" class="span_db"></span></br>
       Site -<span id="db_location" class="span_db"></span> / <span id="site"></span>
      </div>
    </div><!-- /header -->
      <div role="main" class="ui-content" id="farms_barns" style="margin-top: 25px;">
      <ul data-role="listview" data-inset="true" id="barns_list" class="list_view">
        <li data-role="list-divider">Barns List</li>
      </ul>
    </div><!-- /content -->
    <!-- <div data-role="footer" class="foot" data-position="fixed" style="background: url(images/Topbg.png);background-repeat: repeat;" >
      <div class="footermenu3" onclick="db()">
        <a href="#"><img src="images/footer-image-1.png" style="height:100%;" /></a>
      </div>
      <div class="footermenu3" onclick="user_logout();">
        <a href="#"><img src="images/signout.png" style="height:100%;" /></a>
      </div>       
      <div class="footermenu3">
        <a href="#left-panel"><img src="images/footer-image-5.png" style="height:100%;" /></a>
      </div>  
    </div> -->
    <div data-role="panel" data-transition="slide" data-position="left" id="left-panel">
      <ul data-role='listview'>
          <li data-role="list-divider" id="heading_menu">Menu</li>
          <li><a href="#" data-transition="slide" onclick="db()" data-ajax='false' rel="external"><i class='icon-dashboard'></i> Dashboard</a></li>
          <li><a href="#" data-ajoutax='false' data-transition="slide"  onclick="user_logout();" rel="external"><i class='icon-signout'></i> Logout</a></li>
      </ul>
    </div>
  </div>
  <div data-role="page" id="demo-page4" data-url="demo-page4" style="margin-top:15px;">
    <div data-role="header" id="heading">
        <div style="text-align:center; padding-top: 2px;">
            <img src="images/mobile-logo-2.png" />
        </div >
        <a href="#left-panel"><i class='icon-reorder'></i></a>
        <a href="" onclick="barnslis()" id="backbarn"><i class='icon-chevron-left'></i></a>
    </div>
  <div role="main" class="ui-content" style="background-color: #849BD0; width:100%; height:100%;">
    <div id="box1" style="height:15%; padding:10px; width:100%; float:left;">
      <div style="text-align: center;">
          Hog Owner -<span id="db_hog4" ></span><br/>
          <span id="hid">Site -<span id="db_location4" ></span> / <span id="site4"></span></span>
      </div>
      <div style="float:left;">
        <span id="barntitle" class="topboxtitle">Farm Assist</span>       
        <span class="boxtitle1">Temperature</span>
        <span class="boxtitle2" id="temp">23&#176;F</span>
        <!-- <img src="images/image-1.png" style="float:left; width:50%;" /> -->
      </div>  
    </div>

    <div>
    <div id="box2" style="padding:5px;">
      <div style="width:100%; float:left;">
        <div id="sbox1" class="rightbox">
        <div style="width:66%; float:left;">
          <span class="rightboxtitle1">System Status</span>
           <span class="rightboxtitle2" id="s_status">OK</span>
        </div>
        <div style="width:30%; float:left;">
          <img id="statusimg" src="images/s-box-image-1.png" style="width:60%;" />
        </div>
        </div>
      </div>
      </div>

      <div id="box3" style="padding:5px;">
      <div style="width:100%; float:left;">
        <div id="sbox1" class="rightbox" style="border-top:0;">
        <div style="width:66%; float:left;">
          <span class="rightboxtitle1">Humidity</span>
           <span class="rightboxtitle2" id="humidity">43%</span>
        </div>
        <div style="width:30%; float:left;">
          <img src="images/s-box-image-2.png" style="width:60%;" />
          <!-- <img id="statusimg" src="images/s-box-image-1.png" style="width:60%;" /> -->
        </div>
        </div>
      </div>
      </div>


      <div id="box4" style="padding:5px;">
      <div style="width:100%; float:left;">
        <div id="sbox1" class="rightbox" style="border-top:0;">
        <div style="width:66%; float:left;">
          <span class="rightboxtitle1">AC Power</span>
           <span class="rightboxtitle2" id="ac">OK</span>
        </div>
        <div style="width:30%; float:left;">
        <img id="powerimg" src="images/s-box-image-3.png" style="width:60%;" />
          <!-- <img id="statusimg" src="images/s-box-image-1.png" style="width:60%;" /> -->
        </div>
        </div>
      </div>
      </div>

      <div id="box5" style="padding:5px;">
      <div style="width:100%; float:left;">
        <div id="sbox1" class="rightbox" style="border-top:0;">
        <div style="width:66%; float:left;">
          <span class="rightboxtitle1">Events</span>
           <span class="rightboxtitle2"  style="font-size:11px;" id="events">Water level Raised</span>
        </div>
        <div style="width:30%; float:left;">
          <img src="images/s-box-image-4.png" style="width:60%;" />
          <!-- <img id="statusimg" src="images/s-box-image-1.png" style="width:60%;" /> -->
        </div>
        </div>
      </div>
      </div>

      <div id="box6" style="padding:5px;">
      <div style="width:100%; float:left;">
        <div id="sbox1" class="rightbox" style="border-top:0;">
        <div style="width:66%; float:left;">
          <span class="rightboxtitle1">Feed</span>
           <span class="rightboxtitle2" id="s_feed">OK</span>
        </div>
        <div style="width:30%; float:left;">
          <!-- <img id="statusimg" src="images/s-box-image-1.png" style="width:60%;" /> -->
          <img id="feedimg" src="images/s-box-image-1.png" style="width:60%;" />
        </div>
        </div>
      </div>
      </div>

      <div id="box7" style="padding:5px;">
      <div style="width:100%; float:left;">
        <div id="sbox1" class="rightbox" style="border-top:0;">
        <div style="width:100%; float:left;">             
             <!-- <span style="font-size:15px; color:white; font-family:'Open Sans' sans-serif; font-weight:normal; float:left; width: 100%;">Current Inventory :  </span> -->
                <span class="rightboxtitle2" style="font-size:13px;" id="curr_inven"></span>
              
<!-- 
              <span style="font-size:15px; color:white; font-family:'Open Sans' sans-serif; font-weight:normal; float:left; width: 100%;">Pig Deaths : </span> -->
                <span class="rightboxtitle2" style="font-size:13px;" id="death_pig_main"></span>
              

              <!-- <span style="font-size:15px; color:white; font-family:'Open Sans' sans-serif; font-weight:normal; float:left; width: 100%;">Sick Pigs :</span> -->
              <span class="rightboxtitle2" style="font-size:13px;" id="sick_pig_main"></span>
        </div>
        
        </div>
      </div>
      </div>
      </div>





      <!-- <div style="width:100%; float:left;">
        <div id="sbox2" style="width:50%; border-bottom:1px solid white; float:right; background: url(images/box-bg.png);background-repeat: repeat;">
          <div id="divbox2" class="titlebox">
            <span class="boxtitle1">Humidity</span>
            <span class="boxtitle2" id="humidity">43%</span>
          </div>
          <div style="width:20%; float:left;">
            <img src="images/s-box-image-2.png" style="width:80%;" />
          </div>
        </div>          
      </div> -->
    <!--   <div style="width:100%; float:left;">
        <div id="sbox3" style="width:50%; height:55px; border-bottom:1px solid white; float:right; background: url(images/box-bg.png);background-repeat: repeat;">
           <div id="divbox3" class="titlebox">
              <span class="boxtitle1">AC Power</span>
              <span class="boxtitle2" id="ac">OK</span>
            </div>
            <div style="width:20%; float:left;"> 
              <img id="powerimg" src="images/s-box-image-3.png" style="width:80%;" />
            </div>
          </div>
        </div> -->
        <!-- <div style="width:100%; float:left;">
          <div id="sbox4" style="width:50%; height:55px; border-bottom:1px solid white; float:right; background: url(images/box-bg.png);background-repeat: repeat;">
           <div id="divbox4" class="titlebox">
              <span class="boxtitle1">Events</span>
              <span class="boxtitle2"  style="font-size:11px;" id="events">Water level Raised</span>
            </div>
            <div style="width:20%; float:left;"> 
              <img src="images/s-box-image-4.png" style="width:80%;" />
            </div>
          </div>
        </div> -->
        <!-- <div style="width:100%; float:left;">
        <div id="sbox1" style="border-top:1px solid white; width:50%; height:50px; border-bottom:1px solid white; float:right;background: url(images/box-bg.png);background-repeat: repeat;">
        <div id="divbox5" class="titlebox">
          <span class="boxtitle1" >Feed</span>
           <span class="boxtitle2" id="s_feed">OK</span>
        </div>
        <div style="width:20%; float:left;">
          <img id="feedimg" src="images/s-box-image-1.png" style="width:80%;" />
        </div>
        </div>
      </div> -->
        <!-- <div style="width:100%; float:left;">
          <div id="sbox5" style="width:50%;height:50px; border-bottom:1px solid white; float:right; background: url(images/box-bg.png);background-repeat: repeat;">
           <div style="width:90%; float:left;padding-left:5px;">
             
                <span style="font-size:13px; color:white; font-family:'Open Sans' sans-serif; font-weight:bold; float:left; width: 100%;" id="curr_inven"></span>
              

                <span style="font-size:13px; color:white; font-family:'Open Sans' sans-serif; font-weight:bold; float:left; width: 100%;" id="death_pig_main"></span>
              

              
              <span style="font-size:13px; color:white; font-family:'Open Sans' sans-serif; font-weight:bold; float:left; width: 100%;" id="sick_pig_main"></span>
              
            </div>
          </div>
        </div>  -->                
      </div>
    <!-- <div >
    </div> -->
  <!-- </div> -->
  <!-- <div data-role="footer" class="foot" data-position="fixed" style="background: url(images/Topbg.png);background-repeat: repeat;" >
      <div class="footermenu4" onclick="db()">
        <a href="#"><img src="images/footer-image-1.png" style="height:100%;" /></a>
      </div>
      <div class="footermenu4" onclick="inven()">
        <a href="#"><img src="images/footer-image-2.png" style="height:100%;" /></a>
      </div>
      <div class="footermenu4" onclick="ship()">
        <a href="#"><img src="images/footer-image-3.png" style="height:100%;" /></a>
      </div>
      <div class="footermenu4" onclick="user_logout();">
        <a href="#"><img src="images/signout.png" style="height:100%;" /></a>
      </div>       
  </div> -->
  <div data-role="panel" data-transition="slide" data-position="left" data-display="reveal" id="left-panel" style="background:none;">
      <ul data-role='listview'>
          <li data-role="list-divider" id="heading_menu">Menu</li>
          <li><a href="#" data-transition="slide" onclick="db()" data-ajax='false' rel="external"><i class='icon-dashboard'></i> Dashboard</a></li>
          <li><a href="#" data-transition="slide" onclick="inven()" data-ajax='false' rel="external"><i class='icon-dashboard'></i> Inventory</a></li>
          <li><a href="#" data-transition="slide" onclick="ship()" data-ajax='false' rel="external"><i class='icon-dashboard'></i> Shipment</a></li>
          <li><a href="#" data-ajoutax='false' data-transition="slide"  onclick="user_logout();" rel="external"><i class='icon-signout'></i> Logout</a></li>
      </ul>
    </div>
    
  </div>

    <script type="text/javascript" src="cordova.js"></script> 
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/jquery.mobile-1.3.2.min.js"></script>
    <script src="js/authorize_page.js"></script>
    
    <script src="js/page.js"></script> 
    <script src="js/get.js"></script> 
    <script type="text/javascript">
      function clearloc(){
        $('#locations_list li:not(:first)').remove();     
      }
      function clearbarn(){
        $('#barns_list li:not(:first)').remove();
      }
      $(document).on('pagebeforeshow', '#demo-page4', function(){ 
        // alert("abc");
        var role = window.localStorage.getItem('role');
        if(role =="FarmOwner"){
          $("#site4").hide();
        }
        if(role =="SiteManager"){
          $("#site4").hide();
        }
        if(role !="BarnManager"){
        var token = window.localStorage.getItem('login_token');
        var first = window.localStorage.getItem('first_name');
        var last =  window.localStorage.getItem('last_name');
        var user = first +" "+ last ;
        var id =  window.localStorage.getItem('shipid');
        $.ajax({
        type: "GET",
        beforeSend: function() 
        { $.mobile.showPageLoadingMsg("a", "Loading"); }, 
        complete: function() 
        { $.mobile.hidePageLoadingMsg(); },
        url: 'http://nano.amfnano.com/barns/'+id+'/last_reading.json?user_credentials='+token,
        dataType: "json",
        cache: false,
        success: function(data) {        
          // alert("1");
          if(data == null){
          $('#barntitle').text("Farm Central");
          $('#humidity').text("N/A");
          $('#s_status').text("N/A");
          $('#temp').text("N/A");
          $('#ac').text("N/A");
          $('#s_feed').text("N/A");
          $("#statusimg").attr("src", "offline.png");
          $("#powerimg").attr("src", "offline.png");
          $("#feedimg").attr("src", "offline.png");
          }
          else{
          if(data.temperatures.length === 0){
            data.temperatures = "NA";
            // alert(data.temperatures);
             $('#temp').text(data.temperatures);
          }
          else{
             $('#temp').text(data.temperatures[0].value+' F');
          }
          if(data.ir_feeds.length === 0){
            data.ir_feeds = "NA";
            // alert(data.temperatures);
             $('#s_feed').text(data.ir_feeds);
          }
          else{
             $('#s_feed').text(data.ir_feeds[0].status);
          }
          if(data.humidity == null){
            data.humidity = "NA";
            // alert(data.humidity);
          }
          if(data.system_status == null){
            data.system_status = "NA";
            // alert(data.system_status);
          }
          if(data.AC_power == null){
            data.AC_power = "NA";
            // alert(data.AC_power);
          }
          $('#barntitle').text(data.barn_name);
          $('#humidity').text(data.humidity+'%');
          $('#s_status').text(data.system_status);
          $('#ac').text(data.AC_power);
           if(data.system_status == "OK"){
            $("#statusimg").attr("src", "online.png");
          }
          else{
            $("#statusimg").attr("src", "offline.png")
          }
          if(data.AC_power == "OK"){
            $("#powerimg").attr("src", "images/s-box-image-3.png");
          }
          else{
            $("#powerimg").attr("src", "offline.png")
          }
          if(data.ir_feeds[0].status == "OK"){
            $("#feedimg").attr("src", "online.png");
          }
          else{
            $("#feedimg").attr("src", "offline.png")
          }
          }
          // alert("1-finished");
          return false;
        },
        error: function(data,status){
          alert('No Data Found')
        },

        complete: function(data){
          // alert('completed')
        },

        denied: function(data){
          alert('Access denied')
        }
      });

      $.ajax({
        type: "GET",
        url: 'http://nano.amfnano.com/barns/'+id+'/last_event_report.json?user_credentials='+token,
        dataType: "json",
        cache: false,
        success: function(data) {        
          console.log(data);
          // alert("2");
          if(data == null){
            $('#events').text("N/A");
          }
          else{
            $('#events').text(data.description);
          }
          // alert("2-finished");
          return false;
          //alert(data);
        },
        error: function(data,status){
          alert('No Data Found')
        },

        complete: function(data){
          // alert('completed')
        },

        denied: function(data){
          alert('Access denied')
        }
      });
      $.ajax({
        type: "GET",
        url: 'http://nano.amfnano.com/barns/'+id+'/last_inventory_report.json?user_credentials='+token,
        dataType: "json",
        cache: false,
        success: function(data) {  
        var first = window.localStorage.getItem('first_name');
        var last =  window.localStorage.getItem('last_name');
        var user = first +" "+ last ;

        var d = window.localStorage.getItem('loc_name');
        var s = window.localStorage.getItem('farm_name');  
        
        $('#db_hog4').text(user);
        $('#db_location4').text(d);
        $('#site4').text(s);

        if(data == null){
          $('#curr_inven').text("Current Inventory : N/A");
          $('#death_pig_main').text("Pigs Death :N/A");
          $('#sick_pig_main').text("Sick Pigs :N/A");
        } 
        else{
        // alert();
          
          var death_count = data.pig_deaths;
          var val1 ="";
          if(death_count.length > 0){
            var b = death_count.length-1;
            var last = death_count[b];
            val1 = last.count;
            }
            else{
              val1 =0;
            }
          
          var sick_count = data.pig_treatments;
          var val2 ="";
          if(sick_count.length > 0){
            var c = sick_count.length-1;
            var last = sick_count[c];
            val2 = last.count;
            }
            else{
              val2 =0;
            }
          // alert(c);
          // sick_count = data.pig_treatments;
          $('#curr_inven').text("Current Inventory :"+data.total_inventory);
          $('#death_pig_main').text("Pigs Death :"+val1);
          $('#sick_pig_main').text("Sick Pigs :"+val2);
          }   
          // backbarn();
          // alert("3-finished");
          return false;
        },
        error: function(data,status){
          alert('No Data Found')
        },

        complete: function(data){
          // alert('completed')
        },

        denied: function(data){
          alert('Access denied')
        }
      });
    }
    else{
      $("#backbarn").hide();
      $("#hid").hide();
    }
  });
 

    </script>      

</body>
 
</html>